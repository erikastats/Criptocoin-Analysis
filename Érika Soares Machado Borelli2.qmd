---
title: "Análise de crescimento de operações e produtos BIPA"
author: "Érika Soares Machado Borelli"
format: pdf
editor: visual
---

## Introdução

O objetivo deste desafio é avaliar como as operações e produtos da Bipa contribuem para o crescimento da empresa, utilizando dados simulados que representam operações reais da plataforma. Para isso, será proposta uma métrica que reflita de forma consistente esse crescimento e que gere insights acionáveis para orientar decisões estratégicas.

Esse tipo de análise é fundamental para medir o sucesso da plataforma, identificar oportunidades de monetização e garantir um crescimento sustentável.

Após uma etapa de exploração e entendimento dos dados , com atenção à consistência das informações e à jornada dos usuários, definiu-se como métrica principal o **Growth Rate de utilização dos produtos e operações**. Essa métrica mede a taxa de crescimento do número de usuários ativos que realizam transações nos diferentes produtos internos da Bipa, permitindo avaliar tanto a **ampliação da base engajada** quanto o **aumento da profundidade de uso** ao longo do tempo.

## Métrica principal - Growth Rate de Base Engajada

Para este desafio usaremos a Growth Rate, ou Taxa de Crescimento. Ela é um indicador percentual que mede o aumento de um valor ao longo do tempo.

$$ \text{Growth Rate} = \frac{U_{\text{Período Atual}} - U_{\text{Período Anterior}}}{U_{\text{Período Anterior}}} \times 100 $$

Onde:

-   $U_{Período}$ = número de usuários ativos no período, considerando apenas aqueles que realizaram pelo menos uma das seguintes ações:

    -   Criar um cartão;

    -   Realizar uam compra com cartão;

    -   Enviar ou receber uam transferência interna;

    -   Criar um *quote* ou executar um *order*;

    -   Realizar um PIX.

**Critérios de cálculo:**

1.  A métrica será calculada em frequência mensal e anual (quando possível).
2.  Serão considerados apenas meses com registros efetivos de atividade para evitar distorções.
3.  Usuários serão considerados inativos a partir da data de sua última ação registrada e não entrarão nos períodos subsequentes.

Essa definição garante que a taxa de crescimento reflita variações reais na base engajada, e naõ apenas oscilações na base total de caastros ou períodos sem dados relevantes.

## Resultados

```{r bibliotecas}
#| include: true
#| message: false
#| error: false

# Bibliotecas
library(gt)
library(ggplot2)
library(hrbrthemes)
library(dplyr)
library(tidyr)
library(scales)

# Importando banco de dados
source("ccreating_db.R")

# Importando funções
source("funcoes_ciptocoin_analysis.R")

# Importando tables
source("build_tables.R")
```

#### 1. Growth Rate geral da base engajada (mensal)

```{r Q1}
#| message: false
#| error: false
#| echo: false
#| warning: false 
Q1 = query_growth_rate_geral( timeformat = "%Y-%m",
                              colname = "month",
                              title = "mês"
                              )

cum_month <- query_data(Q1)
growth_metric_plot(df = cum_month,
                   xtitle = "Mês",
                   plottitle = "Crescimento mensal de usuários BIPA",
                   xcolname = "month",
                   caption_text = "Fonte: Query Q1 (Apêndice A) — cálculo de novos usuários e growth mensal")

```

O gráfico mostra que, ao longo do tempo, a quantidade absoluta de novos usuários se manteve relativamente constante, com exceção de novembro de 2024, quando houve um pico no número de cadastros. No entanto, como a base de usuários acumulada cresce a cada período, a taxa percentual de crescimento tende a diminuir. Isso é esperado em bases com crescimento linear, mas acumulativo. Mesmo com novos usuários entrando, o impacto relativo em relação ao total é cada vez menor.

#### 2. Growth Rate geral da base engajada (anual)

```{r Q2}
#| message: false
#| error: false
#| echo: false
#| warning: false 
Q2 = query_growth_rate_geral( timeformat = "%Y",
                              colname = "year",
                              title = "ano"
                              )

cum_year <- query_data(Q2)
growth_metric_plot(df = cum_year,
                   xtitle = "Ano",
                   plottitle = "Crescimento anual de usuários BIPA",
                   xcolname = "year",
                   caption_text = "Fonte: Query Q2 (Apêndice A) — cálculo de novos usuários e growth anual")
```

A análise anual reforça a tendência de queda na taxa de crescimento da base de usuários da BIPA. Apesar de o número absoluto de novos usuários ter se mantido estável em 2024 e 2025, o crescimento líquido em 2025 foi nulo, devido à inativação de dois usuários, o mesmo número de novos cadastros registrados no ano.

Essa desaceleração constante nas taxas de crescimento, apesar do número relativo absoluto de novos usuários se matner relativament estável, sugere que a base total está crescendo lentamente ou até se estagnando. O que indica uma possível saturação do público-alvo, redução de aquisição de novos clientes ou desafios em estratégias de retenção e atração.

#### 3. Engajamento por produto - primeira adoção

Mede o momento em que cada usuário usa o produto pela primeira vez

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 

library(dplyr)
library(ggplot2)

adocao <- bind_rows(
  mutate(cum_month_card,        produto = "Cartão (Q3)"),
  mutate(cum_purchase,          produto = "Compra no cartão (Q6)"),
  mutate(cum_PIX_user,          produto = "PIX (Q9)"),
  mutate(cum_transaction_user,  produto = "Transf. interna (Q12)"),
  mutate(cum_quotes_user,       produto = "Quote (Q15)"),
  mutate(cum_orders_user,       produto = "Order (Q18)")
) %>%
  mutate(month = as.Date(paste0(month, "-01"))) %>%
  group_by(produto) %>%
  mutate(
    max_bar = max(new_users_count, na.rm = TRUE),
    max_gr  = max(growth_rate_percent, na.rm = TRUE),
    scale   = ifelse(is.finite(max_bar/max_gr) & max_gr > 0, max_bar/max_gr, 1),
    growth_scaled = growth_rate_percent * scale
  ) %>%
  ungroup()

# último ponto válido de growth para rotular
labels_df <- adocao %>%
  filter(!is.na(growth_rate_percent)) %>%
  group_by(produto) %>%
  slice_tail(n = 1) %>%
  mutate(lbl = paste0(round(growth_rate_percent, 1), "%"))

ggplot(adocao, aes(x = month)) +
  geom_col(aes(y = new_users_count, fill = "Novos usuários"), alpha = 0.6) +
  geom_line(aes(y = growth_scaled, color = "Growth rate"),
            linewidth = 0.9, na.rm = TRUE) +
  geom_point(aes(y = growth_scaled, color = "Growth rate"),
             size = 1.8, na.rm = TRUE) +
  # rótulos em escala reescalada (mesma da linha), mas mostrando o %
  geom_text(
    aes(y = growth_scaled, label = paste0(round(growth_rate_percent, 1), "%")),
    vjust = -0.4, size = 3, color = "darkred", na.rm = TRUE
  ) +
  facet_wrap(~ produto, ncol = 3, scales = "free_y") +
  scale_fill_manual(name = NULL, values = c("Novos usuários" = "#4e66e7")) +
  scale_color_manual(name = NULL, values = c("Growth rate" = "darkred")) +
  scale_y_continuous(
    name = "Novos usuários (absoluto)",
    expand = expansion(mult = c(0, 0.12))  # espaço para os rótulos acima
  ) +
  labs(
    title   = "Primeira adoção por produto (mensal)",
    x       = "Mês",
    caption = "Fonte: Q3, Q6, Q9, Q12, Q15, Q18 (Apêndice A)"
  ) +
  coord_cartesian(clip = "off") +  # permite rótulos passarem um pouco do topo
  theme_minimal(base_size = 11) +
  theme(
    legend.position = "bottom",
    strip.text      = element_text(face = "bold"),
    plot.caption    = element_text(hjust = 0, size = 8)
  )

```

-   **Picos iniciais seguidos de queda acentuada** - A maioria dos produtos apresentou crescimento na primeira adoção nos primeiros meses, mas houve forte retração subsequente, sugerindo que o lançamento ou campanhas iniciais atraíram mais usuários do que períodos posteriores.

-   **Produtos com baixa recorrência de adoção** - “Compra no cartão” e “Orders” mostram números absolutos baixos e pouco crescimento ao longo do tempo, indicando que poucos novos usuários aderem mensalmente a essas funcionalidades.

-   **Diferentes padrões de retenção pós-adoção** - O PIX e as transferências internas, apesar de quedas no growth rate, mantêm um número absoluto de novos usuários relativamente constante em alguns meses, sugerindo potencial de estabilização da adoção.

#### 4. Engajamento por novos eventos

Mede o volume de novos registros/ações (cartões emitidos, compras realizadas, etc). Pode incluir ações repetidas de um mesmo usuário.

#### 5. Engajamento por produto

Mede quantos usuários únicos usaram o produto no mês, independente de ser a primeira vez ou não

código fact MAU por produto e growth (independe de primeira adoção)

3 bullets de insight

```{r}

```

#### Engajamento multi-produto

```{r}

```

gráfico 1: usuários \>- 2 produtos (barras) + % sobre MAU (linha)

gráfico 2: participação dos TOP combos por mês

2 bullets (profundidade de uso + combos líderes)

## Recomendações

3-5 bullets, diretas e acionáveis

## Limitações e próximos passos

Base simulada, meses sem atividade, baixa contagem

## Apêndices

### Apêndice A - SQL completo

#### Q1 - Growth de usuários com ajuste de inativos mensal

*Objetivo*: medir o crescimento real de usuários ativos ao longo do tempo mensalmente, descontando aqueles que ficaram inativos.

*Entrada*: `users`, `card_purchases`, `pix_transactions`, `internal_transfers` , `quotes`, `card_holder`, `orders`

*Saída*: `table(month, new_users_count, cumulative_users, prev_cumulative, growth_rate_percent, avg_growth_rate_percent, max_growth_rate_percent, max_growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q1, "Q1", "Growth de usuários com ajuste de inativos mensal")
```

#### Q2 - Growth de usuários com ajuste de inativos anual

*Objetivo*: medir o crescimento real de usuários ativos ao longo do tempo anualmente, descontando aqueles que ficaram inativos.

*Entrada*: `users`, `card_purchases`, `pix_transactions`, `internal_transfers` , `quotes`, `card_holder`, `orders`

*Saída*: `table(year, new_users_count, cumulative_users, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q2, "Q2", "Growth de usuários com ajuste de inativos anual")
```

#### Q3 - Growth da primeira adoção de cartão por usuário

*Objetivo*: Medir a taxa de crescimento da primeira adoção de cartão (primeiro cartão por usuário) ao longo do tempo. A métrica mostra como evolui o número de usuários que passam a ter cartão pela primeira vez em cada mês. Ou seja, crescimento de ativação inicial do produto “cartão”, não de uso recorrente

*Entrada*: `card_holder`

*Saída*: `table(month, new_users_count, cumulative_users, prev_cumulative, growth_rate_percent,avg_growth_rate_percent, max_growth_rate_percent, max_growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q3, "Q3", "Growth de usuários com primeiro cartão por mês")
```

#### Q4 - Growth de Emissão de Novos Cartões

*Objetivo*: mensurar a taxa de crescimento mensal no número de novos cartões emitidos, considerando o total acumulado ao longo do tempo.

*Entrada*: `card_holder`

*Saída*: `table(month, new_cards_count, cumulative_cards, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q4, "Q4", "Growth de emissão de novos cartões por mês")
```

#### Q5 - Growth de usuários ativos no cartão por mês

*Objetivo*: calcular o número de usuários ativos de cartão em cada mês e medir a taxa de crescimento percentual em relação ao mês anterior.

*Entrada*: `card_holder`

*Saída*: `table(month, new_users_count, prev_users_active, growth_rate_percent, avg, growth_rate_percent, max_growth_rate_percent, max_growth_period)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q5, "Q5", "Growth de usuários ativos no cartão por mês")
```

#### Q6 - Growth da primeira compra em cartão dos usuários por mês

*Objetivo*: calcular a taxa de crescimento mensal de usuários que realizaram sua primeira compra com cartão, considerando o número acumulado ao longo do tempo.

*Entrada*: `card_purchase`

*Saída*: `table(month, new_users_count, cumulative_users, prev_cumulative, growth_rate_percent, avg_growth_rate_percent, max_growth_rate_percent, max_growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q6, "Q6", "Growth de primeira compra em cartão por mês")
```

#### Q7 - Growth de compras em cartões BIPA por mês

*Objetivo*: Medir a evolução mensal no volume de compras realizadas com cartão, calculando a taxa de crescimento em relação ao mês anterior com base no número acumulado de transações.

*Entrada*: `card_purchase`

*Saída*: `table(month, new_purchase_count, cumulative_purchase, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q7, "Q7", "Growth de compras em cartão BIPA por mês")
```

#### Q8 - Growth de usuários que compram com cartão no mês

*Objetivo*: calcular, mês a mês, quantos usuários únicos fizeram ao menos uma compra com cartão e a sua taxa de crescimento.

*Entrada*: `card_purchase`

*Saída*: `table(month, new_users_count, prev_users_active, growth_rate_percent, avg, growth_rate_percent, max_growth_rate_percent, max_growth_period)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q8, "Q8", "Growth de usuários que compram com cartão por mês")
```

#### Q9 - Growth de usuários que realizaram a primeira transação PIX por mês

*Objetivo*: Medir o crescimento no número de usuários que realizaram sua primeira transação via PIX, calculando a taxa de crescimento mensal em relação ao mês anterior com base no volume acumulado.

*Entrada*: `pix_transactions`

*Saída*: `table(month, new_users_count, cumulative_users, prev_cumulative, growth_rate_percent, avg_growth_rate_percent, max_growth_rate_percent, max_growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q9, "Q9", "Growth de primeria transação PIX por mês")
```

#### Q10 - Growth de transações Pix por mês

*Objetivo*: Medir o crescimento no número total de transações PIX realizadas, calculando a taxa de crescimento mensal em relação ao volume acumulado do mês anterior.

*Entrada*: `pix_transactions`

*Saída*: `table(month, new_pix_count, cumulative_pix, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q10, "Q10", "Growth transação PIX por mês")
```

#### Q11 - Growth de usuários ativos em transações Pix por mês

*Objetivo*: calcular, para cada mês, o número de usuários únicos que realizaram ao menos uma transação PIX e calcular a taxa de crescimento percentual desse volume em relação ao mês anterior, permitindo acompanhar a evolução do engajamento mensal do uso de PIX.

*Entrada*: `pix_transactions`

*Saída*: `table(month, new_users_count, prev_users_active, growth_rate_percent, avg, growth_rate_percent, max_growth_rate_percent, max_growth_period)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q11, "Q11", "Growth de usuários ativos usando PIX por mês")
```

#### Q12 - Growth de usuários com primeira transação interna por mês

*Objetivo*: Medir o crescimento no número de usuários que realizaram sua primeira transação interna (seja como remetente ou destinatário), calculando a taxa de crescimento mensal em relação ao total acumulado até o mês anterior.

*Entrada*: `internal_transfers`

*Saída*: `table(month, new_users_count, cumulative_usrs, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q12, "Q12", "Growth transação interna do usuário por mês")
```

#### Q13. Growth de transações internas por mês

*Objetivo*: Medir o crescimento no número total de transações internas realizadas, calculando a taxa de crescimento mensal em relação ao volume acumulado até o mês anterior.

*Entrada*: `internal_transfers`

*Saída*: `table(month, new_it_count, cumulative_it, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q13, "Q13", "Growth transação interna por mês")
```

#### Q14 - Growth de usuários ativos em transações internas por mês

*Objetivo*: Calcular, mensalmente, a quantidade de usuários únicos que participaram de transações internas, seja como remetentes ou destinatários, e medir a taxa de crescimento percentual desse volume em relação ao mês anterior, permitindo avaliar a evolução do uso da funcionalidade de transferências internas.

*Entrada*: `internal_transactions`

*Saída*: `table(month, new_users_count, prev_users_active, growth_rate_percent, avg, growth_rate_percent, max_growth_rate_percent, max_growth_period)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q14, "Q14", "Growth de usuários ativos fazerndo transação interna por mês")
```

#### Q15 - Growth de usuários com primeira criação de quote por mês

*Objetivo*: Medir o crescimento no número de usuários que criaram sua primeira quote no período, calculando a taxa de cresicmento mensal em relação ao total acumulado até o mês anterior.

*Entrada*: `quotes`

*Saída*: `table(month, new_users_count, cumulative_usrs, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q15, "Q15", "Growth de usuários criando quotes por mês")
```

#### Q16 - Growth de quotes criadas por mês

*Objetivo*: Medir o crescimento no núemro total de quotes criadas por mês, calculando a taxa de crescimento em relação ao total acumulado até o mês anterior.

*Entrada*: `quotes`

*Saída*: `table(month, new_quotes_count, cumulative_quotes, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q16, "Q16", "Growth de quotes por mês")
```

#### Q17 - Growth de usuários ativos gerando quotes por mês

*Objetivo*: Identificar, para cada mês, o número de usuários únicos que criaram pelo menos uam quote e calcular a taxa percentual de crescimento desse volume em relação ao mês anterior, permitindo acompanhar a evolução do engajamento dos usuários com a funcionalidade de geração de cotações.

*Entrada*: `quotes`

*Saída*: `table(month, new_users_count, prev_users_active, growth_rate_percent, avg, growth_rate_percent, max_growth_rate_percent, max_growth_period)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q17, "Q17", "Growth de usuários ativos gerando quotes por mês")
```

#### Q18 - Growth de usuários realizando a primeira order por mês

*Objetivo*: Medir o crescimento no número de usuários que realizaram seu primeiro *order* a cada mês, calculando a taxa de crescimento em relação ao acumulado de meses anteriores.

*Entrada*: `orders`

*Saída*: `table(month, new_users_count, cumulative_usrs, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q18, "Q18", "Growth de usuários realiznado a primeira order por mês")
```

#### Q19 - Growth de orders criadas por mês

*Objetivo*: Medir o crescimento no número de orders criadas por mês, calculando a taxa de crescimento em relação ao acumulado do mês anterior.

*Entrada*: `orders`

*Saída*: `table(month, new_order_count, cumulative_order, prev_cumulative, growth_rate_percent)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q14, "Q14", "Growth de orders criadas por mês")
```

#### Q20 - Growth de usuários ativos gerando orders por mês

*Objetivo*: Calcular, mês a mês, o total de usuários únicos qeu realizaram pelo menos uma order e determinar a variçaõ percentual em relação ao mês anterior, possibilitando monitorar o engajamento dos usuários com a funcionalidade de criação ao longo do tempo.

*Entrada*: `order`

*Saída*: `table(month, new_users_count, prev_users_active, growth_rate_percent, avg, growth_rate_percent, max_growth_rate_percent, max_growth_period)`

```{r}
#| message: false
#| error: false
#| echo: false
#| warning: false 
show_sql(Q14, "Q14", "Growth de usuários ativos gerando orders  por mês")
```

### Anexo B - Reprodutibilidade
